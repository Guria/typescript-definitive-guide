# Сборка с использованием ссылок на проекты

![Chapter Cover](./images/chapter-cover.png)

## Ссылки на проекты

Начиная с версии _3.0_, в _TypeScript_ стало возможным более эффективно работать с проектами за счет объединения множества зависимых проектов в общий процесс сборки. Это стало возможным за счет реализации функционала позволяющего ссылаться на другие проекты. Добавленный функционал упростил работу с так называемыми общими репозиториями, то есть, проектами, состоящими из отдельных, зависимых друг от друга и логически схожих, проектами.

Благодаря ссылкам на проекты значительно сократилось время сборки проекта. В этом компилятору `tsc` помогают алгоритмы интеллектуальных инкрементальных сборок, которые компилируют только те части, которые в этом нуждаются. При том что под словом часть подразумевается не только фрагмент программы, но и отдельные проекты. Кроме того, ссылки на проекты, после сборки, повторяют исходную структуру связанных зависимостей, что немаловажно при работе с разбитыми на части проектами.

Ссылки на проекты указываются в конфигурационном файле `tsconfig.json`, в который было добавлено новое свойство верхнего уровня `references`. Свойство references ассоциируется с массивом объектов, поля которого описывают установки для связываемых проектов. Одним из ключевых полей является path, которое ссылается на конфигурационный файл `tsconfig.json` либо же директорию, которая должна обязательно его содержать.

```typescript
{
 "compilerOptions": {
   "composite": true,
   "declaration": true,

   "outDir": "path/to/outdir/"
 },
 "references": [
   { "path": "path/to/tsconfig.json" },
   { "path": "path/to/dir/with/tsconfig.json/" }
 ]
}
```

Не менее важную роль в конфигурационном файле играет новый флаг `composite`, который, при использовании ссылок на проекты, должен быть обязательно установлено в `true`, чтобы гарантировать активацию других параметров необходимых для более эффективной и быстрой работы поиска зависимостей. Активация флага composite переопределяет некоторое стандартное поведение. Так например, если параметр `rootDir` не установлен явно, то он будет ссылается на директорию содержащую конфигурационный файл `tsconfig.json`. Кроме того, активация флага `composite` требует активацию флага `declaration`.

Помимо перечисленного разработчики _TypeScript_ добавили возможность для других инструментов сборки взаимодействовать с механизмом ссылок на проекты с помощью _API_. Это будет неоценимо на крупных проектах, а для случаев работы над небольшими проектами, специально был добавлен новый флаг компилятора `--build`.

Команда компилятора `--build` ожидает перечисление конфигурационных файлов файлов и может быть использована совместно с такими специфичными для данной команды флагами, как `--verbose`, `--dry`, `--clean` и `--force`.

Флаг `--verbose` выводит подробную информацию о сборке и может сочетаться с любыми другими флагами. Флаг `--dry` выполняет сборку не порождая выходные файлы. Флаг `--clean` удаляет выходные файлы соответствующие заданным входным. `--force` принудительно выполняет не инкрементальную сборку. Кроме того, команда `--build` может сочетаться с такой командой как `--watch`, которая, из всех специфичных для `--build` флагов, сочетается только с флагом `--verbose`.

Также не лишним будет упомянуть, что при использовании команды `--build` компилятор ведет себя так, будто опция `--noEmitOnError` установлена в `true`. Причина этому инкрементальная сборка, которая, при наличии ошибки в коде, выводит уведомления только при непосредственной компиляции, которая возникает исключительно при условии внесения изменения в компилируемый граф зависимостей, что может привести к трудно выявляемым багам. Ведь если разработчик, при возникновении множества ошибок, первым делом возьмется за устранение ошибок возникших в других зависимостях, об ошибках в коде, которого изменения не коснулись, компилятор сообщать уже не будет. Но несмотря на отсутствие ошибок в консоли, ошибки так и останутся в программе.
